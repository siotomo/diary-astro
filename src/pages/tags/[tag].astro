---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import Card from '../../components/Card.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');

  // 全タグを収集
  const allTags = [...new Set(posts.flatMap((post) => post.data.tags))];

  return allTags.map((tag) => ({
    params: { tag },
    props: {
      tag,
      posts: posts.filter((post) => post.data.tags.includes(tag)),
    },
  }));
}

const { tag, posts } = Astro.props;
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Base title={`#${tag} の記事`}>
  <div class="mb-8">
    <a href="/" class="text-blue-600 hover:text-blue-800 transition-colors text-sm">
      ← 記事一覧に戻る
    </a>
  </div>

  <h1 class="text-3xl font-bold text-gray-900 mb-2">#{tag}</h1>
  <p class="text-gray-500 mb-8">{sortedPosts.length}件の記事</p>

  <div class="space-y-6">
    {sortedPosts.map((post) => (
      <Card
        title={post.data.title}
        date={post.data.date}
        tags={post.data.tags}
        description={post.data.description}
        href={`/posts/${post.id}`}
      />
    ))}
  </div>
</Base>
